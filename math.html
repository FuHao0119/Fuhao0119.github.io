<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€ƒç ”æ•°å­¦å…¬å¼é»˜å†™ç¥å™¨ V4.0 (é«˜æ¸…ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        canvas { cursor: crosshair; touch-action: none; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* --- æ ¸å¿ƒä¿®æ”¹ï¼šå…¨å±€æ”¾å¤§å…¬å¼å­—ä½“ --- */
        .katex { font-size: 1.4em !important; line-height: 1.6 !important; }
        /* åœ¨ç­”æ¡ˆåŒºåŸŸæ›´å¤§ä¸€äº› */
        #katex-answer .katex { font-size: 1.8em !important; color: #1e3a8a; }
        /* åˆ—è¡¨ä¸­çš„å…¬å¼æ ·å¼ä¼˜åŒ– */
        .formula-display { overflow-x: auto; padding: 0.5rem 0; }
    </style>
</head>
<body class="bg-slate-100 h-screen flex overflow-hidden">

<aside class="w-72 bg-white shadow-2xl flex flex-col z-20 flex-shrink-0">
    <div class="p-6 bg-indigo-900 text-white">
        <h1 class="font-bold text-2xl tracking-wide">è€ƒç ”æ•°å­¦<br><span class="text-base font-light text-indigo-200">å¤ä¹  & é»˜å†™ V4.0</span></h1>
        <p class="text-xs text-indigo-300 mt-2">ä¸“ä¸º Fu Hao å®šåˆ¶</p>
    </div>
    <nav class="flex-1 overflow-y-auto p-4 space-y-1">

        <div class="nav-header">åŸºç¡€åœ°åŸº (é«˜ä¸­+æé™)</div>
        <button onclick="selectCategory('trig_basic')" class="nav-btn">é«˜ä¸­ä¸‰è§’å‡½æ•° (èƒŒè¯µ)</button>
        <button onclick="selectCategory('limits')" class="nav-btn">å¸¸ç”¨æé™ & æ— ç©·å°</button>

        <div class="nav-header mt-4">å¯¼æ•°ä¸å¾®åˆ†</div>
        <button onclick="selectCategory('derivative')" class="nav-btn">åŸºæœ¬å¯¼æ•°å…¬å¼ (16ä¸ª)</button>

        <div class="nav-header mt-4">ç§¯åˆ†å­¦ (é‡éš¾ç‚¹)</div>
        <button onclick="selectCategory('integrals_basic')" class="nav-btn">ä¸å®šç§¯åˆ†åŸºæœ¬è¡¨</button>
        <button onclick="selectCategory('integrals_sub1')" class="nav-btn">ç¬¬ä¸€æ¢å…ƒæ³• (å‡‘å¾®åˆ†)</button>
        <button onclick="selectCategory('integrals_sub2')" class="nav-btn text-indigo-600 font-bold bg-indigo-50">ç¬¬äºŒæ¢å…ƒæ³• (ä¸‰è§’ä»£æ¢)</button>
    </nav>
</aside>

<main class="flex-1 flex flex-col h-full relative min-w-0">

    <header class="bg-white border-b px-6 py-4 flex justify-between items-center shadow-sm z-10 flex-shrink-0">
        <div class="overflow-hidden">
            <h2 id="current-category-title" class="text-2xl font-bold text-gray-800 truncate">ç¬¬äºŒæ¢å…ƒæ³• (ä¸‰è§’ä»£æ¢)</h2>
            <p id="current-desc" class="text-sm text-gray-500 mt-1 truncate">å»æ ¹å·çš„ç¥å™¨ï¼Œæ³¨æ„ t çš„å–å€¼èŒƒå›´</p>
        </div>

        <div class="bg-gray-100 p-1 rounded-lg flex space-x-1 flex-shrink-0 ml-4">
            <button onclick="switchMode('review')" id="tab-review" class="tab-btn active">
                ğŸ“– èƒŒè¯µæ¨¡å¼
            </button>
            <button onclick="switchMode('practice')" id="tab-practice" class="tab-btn">
                âœï¸ é»˜å†™æ¨¡å¼
            </button>
        </div>
    </header>

    <div class="flex-1 overflow-hidden relative bg-slate-100 p-4 sm:p-6">

        <div id="view-review" class="h-full overflow-y-auto pb-20 no-scrollbar hidden">
            <div class="max-w-5xl mx-auto grid grid-cols-1 gap-5" id="review-list">
            </div>
        </div>

        <div id="view-practice" class="h-full flex flex-col hidden max-w-5xl mx-auto w-full">
            <div class="flex justify-between items-end mb-3 px-1 flex-shrink-0">
                <span class="text-sm text-gray-500 italic hidden sm:inline">æç¤ºï¼šé‡åˆ°æ ¹å·ä¸è¦æ…Œï¼Œä¸‰è§’ä»£æ¢å¸®å¤§å¿™</span>
                <div class="flex space-x-2">
                    <button onclick="clearCanvas()" class="action-btn bg-white text-gray-700 border border-gray-300">
                        ğŸ—‘ï¸ æ¸…ç©º
                    </button>
                    <button onclick="nextQuestion()" class="action-btn bg-indigo-600 text-white shadow-md hover:bg-indigo-700">
                        ğŸ² æ¢ä¸€é¢˜
                    </button>
                </div>
            </div>

            <div class="flex-1 bg-white rounded-2xl shadow-xl border border-gray-200 flex flex-col overflow-hidden">

                <div class="bg-slate-50 px-6 py-6 border-b border-gray-200 min-h-[100px] flex flex-col justify-center">
                    <span class="text-xs font-bold text-indigo-500 uppercase tracking-wide mb-2">é¢˜ç›® / Question</span>
                    <div id="question-text" class="text-2xl md:text-3xl font-serif text-gray-900 leading-snug"></div>
                </div>

                <div class="flex-1 relative bg-white cursor-crosshair touch-none" id="canvas-container">
                    <canvas id="drawing-board" class="w-full h-full block"></canvas>
                    <div class="absolute inset-0 pointer-events-none flex items-center justify-center opacity-[0.05]">
                        <span class="text-8xl font-bold text-gray-900">æ‰‹å†™åŒº</span>
                    </div>
                </div>

                <div class="p-5 border-t border-gray-100 bg-white z-10 flex-shrink-0">
                    <div id="answer-section" class="hidden mb-4 animate-fade-in">
                        <div class="p-5 bg-indigo-50 rounded-xl border border-indigo-100 flex flex-col items-start gap-2">
                            <span class="bg-indigo-200 text-indigo-900 text-xs font-bold px-2 py-1 rounded">æ ‡å‡†ç­”æ¡ˆ</span>
                            <div id="katex-answer" class="w-full overflow-x-auto py-2"></div>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mt-4">
                            <button onclick="recordResult(false)" class="py-3 rounded-lg border border-red-200 bg-red-50 text-red-700 font-bold hover:bg-red-100 transition text-lg">âŒ æ²¡å†™å¯¹</button>
                            <button onclick="recordResult(true)" class="py-3 rounded-lg bg-green-600 text-white font-bold hover:bg-green-700 shadow-lg transition text-lg">âœ… å†™å¯¹äº†</button>
                        </div>
                    </div>

                    <button id="show-answer-btn" onclick="showAnswer()" class="w-full py-4 bg-gray-800 hover:bg-black text-white rounded-xl font-bold text-xl shadow-lg transition-all transform hover:-translate-y-1">
                        ğŸ‘€ æŸ¥çœ‹ç­”æ¡ˆ
                    </button>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    // --- æ ¸å¿ƒæ•°æ® (V4.0 å…¨é¢æ‰©å……) ---
    const formulaData = {
        // 1. é«˜ä¸­ä¸‰è§’å‡½æ•° (æ–°å¢)
        'trig_basic': [
            { q: "å¹³æ–¹å…³ç³»ï¼šsinÂ²x + cosÂ²x = ?", a: "1" },
            { q: "å¹³æ–¹å…³ç³»ï¼š1 + tanÂ²x = ?", a: "\\sec^2 x" },
            { q: "å¹³æ–¹å…³ç³»ï¼š1 + cotÂ²x = ?", a: "\\csc^2 x" },
            { q: "äºŒå€è§’ï¼šsin(2x)", a: "2\\sin x \\cos x" },
            { q: "äºŒå€è§’ï¼šcos(2x) (ä¸‰ç§)", a: "\\cos^2 x - \\sin^2 x = 2\\cos^2 x - 1 = 1 - 2\\sin^2 x" },
            { q: "é™å¹‚å…¬å¼ï¼šsinÂ²x", a: "\\frac{1 - \\cos(2x)}{2}" },
            { q: "é™å¹‚å…¬å¼ï¼šcosÂ²x", a: "\\frac{1 + \\cos(2x)}{2}" },
            { q: "å’Œå·®åŒ–ç§¯ï¼šsin A + sin B", a: "2\\sin\\frac{A+B}{2}\\cos\\frac{A-B}{2}" },
            { q: "å’Œå·®åŒ–ç§¯ï¼šcos A + cos B", a: "2\\cos\\frac{A+B}{2}\\cos\\frac{A-B}{2}" },
            { q: "ç§¯åŒ–å’Œå·®ï¼šsin A cos B", a: "\\frac{1}{2}[\\sin(A+B) + \\sin(A-B)]" },
            { q: "ç§¯åŒ–å’Œå·®ï¼šcos A cos B", a: "\\frac{1}{2}[\\cos(A+B) + \\cos(A-B)]" },
            { q: "ç‰¹æ®Šè§’ï¼šsin(30Â°), sin(45Â°), sin(60Â°)", a: "\\frac{1}{2}, \\frac{\\sqrt{2}}{2}, \\frac{\\sqrt{3}}{2}" },
            { q: "è¯±å¯¼å…¬å¼ï¼šsin(Ï€/2 - x)", a: "\\cos x" },
            { q: "è¯±å¯¼å…¬å¼ï¼šcos(Ï€/2 + x)", a: "-\\sin x" }
        ],
        // 2. æé™
        'limits': [
            { q: "x->0, sin x ~ ?", a: "x" },
            { q: "x->0, tan x ~ ?", a: "x" },
            { q: "x->0, arcsin x ~ ?", a: "x" },
            { q: "x->0, arctan x ~ ?", a: "x" },
            { q: "x->0, ln(1+x) ~ ?", a: "x" },
            { q: "x->0, e^x - 1 ~ ?", a: "x" },
            { q: "x->0, (1+x)^a - 1 ~ ?", a: "ax" },
            { q: "x->0, 1 - cos x ~ ?", a: "\\frac{1}{2}x^2" },
            { q: "x->0, a^x - 1 ~ ?", a: "x \\ln a" },
            { q: "æ³°å‹’å±•å¼€ (sin x) åˆ° x^3", a: "x - \\frac{1}{6}x^3 + o(x^3)" },
            { q: "æ³°å‹’å±•å¼€ (cos x) åˆ° x^4", a: "1 - \\frac{1}{2}x^2 + \\frac{1}{24}x^4 + o(x^4)" },
            { q: "æ³°å‹’å±•å¼€ (e^x) åˆ° x^2", a: "1 + x + \\frac{1}{2}x^2 + o(x^2)" },
            { q: "é‡è¦æé™ï¼š(1 + 1/x)^x (x->âˆ)", a: "e" },
            { q: "é‡è¦æé™ï¼šsin x / x (x->0)", a: "1" }
        ],
        // 3. å¯¼æ•°
        'derivative': [
            { q: "(x^a)'", a: "a x^{a-1}" },
            { q: "(a^x)'", a: "a^x \\ln a" },
            { q: "(e^x)'", a: "e^x" },
            { q: "(ln x)'", a: "\\frac{1}{x}" },
            { q: "(log_a x)'", a: "\\frac{1}{x \\ln a}" },
            { q: "(sin x)'", a: "\\cos x" },
            { q: "(cos x)'", a: "-\\sin x" },
            { q: "(tan x)'", a: "\\sec^2 x" },
            { q: "(cot x)'", a: "-\\csc^2 x" },
            { q: "(sec x)'", a: "\\sec x \\tan x" },
            { q: "(csc x)'", a: "-\\csc x \\cot x" },
            { q: "(arcsin x)'", a: "\\frac{1}{\\sqrt{1-x^2}}" },
            { q: "(arccos x)'", a: "-\\frac{1}{\\sqrt{1-x^2}}" },
            { q: "(arctan x)'", a: "\\frac{1}{1+x^2}" },
            { q: "(arccot x)'", a: "-\\frac{1}{1+x^2}" }
        ],
        // 4. ç§¯åˆ†åŸºç¡€
        'integrals_basic': [
            { q: "âˆ« k dx", a: "kx + C" },
            { q: "âˆ« x^a dx (aâ‰ -1)", a: "\\frac{1}{a+1}x^{a+1} + C" },
            { q: "âˆ« 1/x dx", a: "\\ln|x| + C" },
            { q: "âˆ« a^x dx", a: "\\frac{a^x}{\\ln a} + C" },
            { q: "âˆ« e^x dx", a: "e^x + C" },
            { q: "âˆ« sin x dx", a: "-\\cos x + C" },
            { q: "âˆ« cos x dx", a: "\\sin x + C" },
            { q: "âˆ« sec^2 x dx", a: "\\tan x + C" },
            { q: "âˆ« csc^2 x dx", a: "-\\cot x + C" },
            { q: "âˆ« sec x tan x dx", a: "\\sec x + C" },
            { q: "âˆ« csc x cot x dx", a: "-\\csc x + C" },
            { q: "âˆ« sec x dx", a: "\\ln|\\sec x + \\tan x| + C" },
            { q: "âˆ« csc x dx", a: "\\ln|\\csc x - \\cot x| + C" },
            { q: "âˆ« 1/(1+x^2) dx", a: "\\arctan x + C" },
            { q: "âˆ« 1/âˆš(1-x^2) dx", a: "\\arcsin x + C" },
            { q: "âˆ« 1/(a^2+x^2) dx", a: "\\frac{1}{a} \\arctan \\frac{x}{a} + C" },
            { q: "âˆ« 1/(x^2-a^2) dx", a: "\\frac{1}{2a} \\ln |\\frac{x-a}{x+a}| + C" },
            { q: "âˆ« 1/âˆš(a^2-x^2) dx", a: "\\arcsin \\frac{x}{a} + C" },
            { q: "âˆ« 1/âˆš(x^2+a^2) dx", a: "\\ln(x+\\sqrt{x^2+a^2}) + C" },
            { q: "âˆ« 1/âˆš(x^2-a^2) dx", a: "\\ln|x+\\sqrt{x^2-a^2}| + C" }
        ],
        // 5. å‡‘å¾®åˆ†
        'integrals_sub1': [
            { q: "å‡‘ d(ax+b)", a: "\\frac{1}{a} d(ax+b)" },
            { q: "å‡‘ d(x^2)", a: "\\frac{1}{2} d(x^2) = x dx" },
            { q: "å‡‘ d(ln x)", a: "d(\\ln x) = \\frac{1}{x} dx" },
            { q: "å‡‘ d(e^x)", a: "d(e^x) = e^x dx" },
            { q: "å‡‘ d(sin x)", a: "d(\\sin x) = \\cos x dx" },
            { q: "å‡‘ d(cos x)", a: "d(\\cos x) = -\\sin x dx" },
            { q: "å‡‘ d(tan x)", a: "d(\\tan x) = \\sec^2 x dx" },
            { q: "å‡‘ d(arctan x)", a: "d(\\arctan x) = \\frac{1}{1+x^2} dx" }
        ],
        // 6. ç¬¬äºŒæ¢å…ƒ (çŸ¥è¯†ç‚¹+å…¬å¼) (æ–°å¢)
        'integrals_sub2': [
            { q: "é‡åˆ° âˆš(aÂ² - xÂ²) å¦‚ä½•ä»£æ¢?", a: "ä»¤ x = a\\sin t, \\; t \\in [-\\frac{\\pi}{2}, \\frac{\\pi}{2}]" },
            { q: "é‡åˆ° âˆš(aÂ² + xÂ²) å¦‚ä½•ä»£æ¢?", a: "ä»¤ x = a\\tan t, \\; t \\in (-\\frac{\\pi}{2}, \\frac{\\pi}{2})" },
            { q: "é‡åˆ° âˆš(xÂ² - aÂ²) å¦‚ä½•ä»£æ¢?", a: "ä»¤ x = a\\sec t, \\; t \\in [0, \\frac{\\pi}{2}) \\cup [\\pi, \\frac{3\\pi}{2})" },
            { q: "å»æ ¹å·åŸç†ï¼šâˆš(aÂ² - aÂ²sinÂ²t) = ?", a: "a\\cos t \\; (\\text{å› ä¸º } \\cos t \\ge 0)" },
            { q: "å»æ ¹å·åŸç†ï¼šâˆš(aÂ² + aÂ²tanÂ²t) = ?", a: "a\\sec t" },
            { q: "å€’ä»£æ¢ï¼šè¢«ç§¯å‡½æ•°åˆ†æ¯å¹‚æ¬¡é«˜æ—¶", a: "ä»¤ x = \\frac{1}{t}, \\; dx = -\\frac{1}{t^2}dt" }
        ]
    };

    // --- é€»è¾‘æ§åˆ¶ ---
    let currentCategory = 'integrals_sub2'; // é»˜è®¤æ‰“å¼€æ–°åŠŸèƒ½
    let currentMode = 'review';
    let currentItem = null;

    function init() {
        selectCategory('integrals_sub2');
        switchMode('review');
    }

    function selectCategory(key) {
        currentCategory = key;
        const titles = {
            'trig_basic': 'é«˜ä¸­ä¸‰è§’å‡½æ•°åŸºç¡€',
            'limits': 'å¸¸ç”¨æé™ & æ— ç©·å°',
            'derivative': 'åŸºæœ¬å¯¼æ•°å…¬å¼',
            'integrals_basic': 'ä¸å®šç§¯åˆ†åŸºæœ¬è¡¨',
            'integrals_sub1': 'ç¬¬ä¸€æ¢å…ƒæ³• (å‡‘å¾®åˆ†)',
            'integrals_sub2': 'ç¬¬äºŒæ¢å…ƒæ³• (ä¸‰è§’ä»£æ¢)'
        };
        const descs = {
            'trig_basic': 'è€ƒç ”æ•°å­¦çš„åœ°åŸºï¼ŒèƒŒä¸ç†Ÿç§¯åˆ†æ ¹æœ¬æ²¡æ³•åšã€‚',
            'limits': 'åŒ…å«æ³°å‹’å…¬å¼å’Œå¸¸è§ç­‰ä»·æ— ç©·å°ã€‚',
            'derivative': 'è®¡ç®—é€Ÿåº¦çš„ä¿è¯ã€‚',
            'integrals_basic': 'å¿…é¡»æ»šç“œçƒ‚ç†Ÿçš„ 20 ä¸ªå…¬å¼ã€‚',
            'integrals_sub1': 'é€†å‘æ€ç»´ï¼ŒæŠŠ f(x)dx å‡‘æˆ d(u)ã€‚',
            'integrals_sub2': 'ä¸“é—¨è§£å†³å¸¦æ ¹å·çš„ç§¯åˆ†ï¼Œæ³¨æ„ t çš„èŒƒå›´ï¼'
        };

        document.getElementById('current-category-title').innerText = titles[key];
        document.getElementById('current-desc').innerText = descs[key];

        // èœå•é«˜äº®é€»è¾‘
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.className = 'nav-btn text-left px-4 py-3 rounded-lg text-sm font-medium transition border-l-4 border-transparent w-full text-gray-700 hover:bg-indigo-50';
        });
        // æ‰¾åˆ°å¯¹åº”æŒ‰é’®é«˜äº® (ç®€å•æ–‡æœ¬åŒ¹é…)
        const allBtns = document.querySelectorAll('.nav-btn');
        for(let btn of allBtns) {
            if(btn.innerText.includes(titles[key].split(' ')[0])) {
                btn.classList.add('bg-indigo-50', 'border-indigo-600', 'text-indigo-800');
                btn.classList.remove('border-transparent');
            }
        }

        if (currentMode === 'review') renderReviewList();
        else nextQuestion();
    }

    function switchMode(mode) {
        currentMode = mode;
        const reviewBtn = document.getElementById('tab-review');
        const practiceBtn = document.getElementById('tab-practice');
        const reviewView = document.getElementById('view-review');
        const practiceView = document.getElementById('view-practice');

        if (mode === 'review') {
            reviewBtn.classList.add('active'); practiceBtn.classList.remove('active');
            reviewView.classList.remove('hidden'); practiceView.classList.add('hidden');
            renderReviewList();
        } else {
            practiceBtn.classList.add('active'); reviewBtn.classList.remove('active');
            practiceView.classList.remove('hidden'); reviewView.classList.add('hidden');
            if (!currentItem) nextQuestion();
            setTimeout(resizeCanvas, 50);
        }
    }

    function renderReviewList() {
        const listContainer = document.getElementById('review-list');
        listContainer.innerHTML = '';

        const list = formulaData[currentCategory];
        list.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = "bg-white p-5 rounded-xl shadow-sm border border-gray-100 flex flex-col items-start gap-3 hover:shadow-md transition";

            const qDiv = document.createElement('div');
            qDiv.className = "text-sm font-bold text-gray-400 uppercase tracking-wider";
            qDiv.innerText = `${index + 1}. ${item.q}`;

            const aDiv = document.createElement('div');
            aDiv.className = "formula-display w-full";

            card.appendChild(qDiv);
            card.appendChild(aDiv);
            listContainer.appendChild(card);

            katex.render(item.a, aDiv, { throwOnError: false, displayMode: true });
        });
    }

    function nextQuestion() {
        const list = formulaData[currentCategory];
        const randomIndex = Math.floor(Math.random() * list.length);
        currentItem = list[randomIndex];

        document.getElementById('question-text').innerText = currentItem.q;
        document.getElementById('answer-section').classList.add('hidden');
        document.getElementById('show-answer-btn').classList.remove('hidden');
        document.getElementById('katex-answer').innerHTML = '';
        clearCanvas();
    }

    function showAnswer() {
        const answerDiv = document.getElementById('katex-answer');
        katex.render(currentItem.a, answerDiv, {
            throwOnError: false,
            displayMode: true
        });
        document.getElementById('answer-section').classList.remove('hidden');
        document.getElementById('show-answer-btn').classList.add('hidden');
    }

    function recordResult(isCorrect) { nextQuestion(); }

    // --- æ ·å¼è¾…åŠ© ---
    const style = document.createElement('style');
    style.textContent = `
            .nav-header { font-size: 0.75rem; font-weight: 800; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.05em; padding: 0.5rem 0.5rem 0.25rem; }
            .tab-btn { padding: 0.5rem 1.25rem; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 700; transition: all 0.2s; }
            .tab-btn.active { background-color: white; color: #4338ca; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
            .tab-btn:not(.active) { color: #6b7280; }
            .tab-btn:not(.active):hover { color: #111827; }
            .action-btn { padding: 0.5rem 1rem; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 500; transition: all 0.2s; }
            .animate-fade-in { animation: fadeIn 0.3s ease-out; }
            @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        `;
    document.head.appendChild(style);

    // --- Canvas ç”»æ¿ ---
    const canvas = document.getElementById('drawing-board');
    const ctx = canvas.getContext('2d');
    let isDrawing = false, lastX = 0, lastY = 0;

    function resizeCanvas() {
        const container = document.getElementById('canvas-container');
        if (container.clientWidth === 0) return;
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
        ctx.lineJoin = 'round'; ctx.lineCap = 'round'; ctx.lineWidth = 3; ctx.strokeStyle = '#1e1b4b';
    }
    window.addEventListener('resize', resizeCanvas);

    function getPos(e) {
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return { x: clientX - rect.left, y: clientY - rect.top };
    }
    function startDraw(e) { isDrawing = true; const pos = getPos(e); lastX = pos.x; lastY = pos.y; if(e.type==='touchstart') e.preventDefault(); }
    function draw(e) { if(!isDrawing) return; const pos = getPos(e); ctx.beginPath(); ctx.moveTo(lastX, lastY); ctx.lineTo(pos.x, pos.y); ctx.stroke(); lastX = pos.x; lastY = pos.y; if(e.type==='touchmove') e.preventDefault(); }
    function stopDraw() { isDrawing = false; }
    function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }

    canvas.addEventListener('mousedown', startDraw); canvas.addEventListener('mousemove', draw); canvas.addEventListener('mouseup', stopDraw); canvas.addEventListener('mouseout', stopDraw);
    canvas.addEventListener('touchstart', startDraw, {passive: false}); canvas.addEventListener('touchmove', draw, {passive: false}); canvas.addEventListener('touchend', stopDraw);

    init();
</script>
</body>
</html>